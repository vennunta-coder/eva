<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EVA - Assistente</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .bubble-eva {
      border-radius: 1.5rem;
      border-top-left-radius: 0.5rem;
      background-color: #f1f1f1;
      color: #1c1e21;
    }
    .bubble-user {
      border-radius: 1.5rem;
      border-top-right-radius: 0.5rem;
      background-color: #0078FF;
      color: white;
    }
    .typing-indicator span {
      animation: pulse-fade 1.5s infinite;
      display: inline-block;
      width: 8px; height: 8px;
      background-color: #0078FF;
      border-radius: 50%; margin-right: 4px;
    }
    @keyframes pulse-fade {
      0%,100% { opacity: .5 } 50% { opacity: 1 }
    }
  </style>
</head>
<body class="bg-gray-100 flex flex-col min-h-screen">

  <!-- HEADER -->
  <header class="bg-white shadow-sm border-b border-gray-200 flex items-center justify-between px-6 h-16">
    <div class="flex items-center space-x-3">
      <img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/logoeva.png" class="w-10 h-10">
      <span class="text-2xl font-bold">
        <span style="color:black">E</span><span style="color:orange">V</span><span style="color:black">A</span>
      </span>
    </div>
  </header>

  <!-- CHAT -->
  <main class="flex-1 flex flex-col max-w-3xl w-full mx-auto p-4 space-y-4 overflow-y-auto" id="chat-messages">
    <div class="flex justify-start">
      <div class="max-w-[80%] p-3 bubble-eva flex space-x-2">
        <img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/logoeva.png" class="w-6 h-6 rounded-full">
        <p>Ol√°! Eu sou a EVA.<br>J√° vens com choradeira ou com piada?</p>
      </div>
    </div>
  </main>

  <!-- INPUT -->
  <div class="bg-white border-t border-gray-200 p-4 flex items-center space-x-2">
    <textarea id="user-input"
      class="flex-1 resize-none border rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"
      placeholder="Escreve a tua mensagem..." rows="1"></textarea>
    <button id="send-button" class="bg-blue-500 hover:bg-blue-600 text-white rounded-full px-5 py-2">Enviar</button>
  </div>

  <!-- FOOTER -->
  <footer class="bg-gray-50 text-center text-sm py-2 border-t">
    <span class="font-bold">
      <span style="color:black">E</span><span style="color:orange">V</span><span style="color:black">A</span>
    </span> ¬© 2025
  </footer>

  <script>
    const GOOGLE_KEY = "AIzaSyD3OOOrDwc5KtuiUAzg1Pq2dGGVaRJjU3s";
    const WEATHER_KEY = "7db838cde261492656dc201d1d17e4aa";

    const chat = document.getElementById("chat-messages");
    const input = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-button");

    function appendMessage(sender, text) {
      const div = document.createElement("div");
      div.className = "flex " + (sender === "user" ? "justify-end" : "justify-start");
      div.innerHTML = `
        <div class="max-w-[80%] p-3 ${sender==="user"?"bubble-user":"bubble-eva"} flex space-x-2">
          ${sender==="eva" ? `<img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/logoeva.png" class="w-6 h-6 rounded-full">` : ""}
          <p>${text}</p>
        </div>`;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function showTyping() {
      const div = document.createElement("div");
      div.id = "typing";
      div.className = "flex justify-start";
      div.innerHTML = `
        <div class="max-w-[80%] p-3 bubble-eva flex space-x-2">
          <img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/logoeva.png" class="w-6 h-6 rounded-full">
          <div class="typing-indicator flex mt-1">
            <span></span><span></span><span></span>
          </div>
        </div>`;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    function removeTyping() {
      const typing = document.getElementById("typing");
      if (typing) typing.remove();
    }

    async function getWeather(city) {
      try {
        const r = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&lang=pt&appid=${WEATHER_KEY}`);
        const d = await r.json();
        if (d.main) return `üå°Ô∏è ${d.name}: ${d.main.temp}¬∞C, ${d.weather[0].description}`;
        return "N√£o encontrei o clima dessa cidade.";
      } catch { return "Erro ao obter clima."; }
    }

    async function getWiki(query) {
      try {
        const r = await fetch(`https://pt.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
        if (!r.ok) return null;
        const d = await r.json();
        return d.extract ? `${d.extract} <br><a href="${d.content_urls.desktop.page}" target="_blank">üîó Ler mais</a>` : null;
      } catch { return null; }
    }

    async function getYouTube(query) {
      try {
        const r = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=1&q=${encodeURIComponent(query)}&key=${GOOGLE_KEY}`);
        const d = await r.json();
        if (d.items && d.items.length > 0) {
          const v = d.items[0];
          return `üé• Encontrei um v√≠deo: <a href="https://www.youtube.com/watch?v=${v.id.videoId}" target="_blank">${v.snippet.title}</a>`;
        }
        return null;
      } catch { return null; }
    }

    async function translateText(text, targetLang) {
      try {
        const resp = await fetch(`https://translation.googleapis.com/language/translate/v2?key=${GOOGLE_KEY}`, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({ q: text, target: targetLang })
        });
        const data = await resp.json();
        return data.data?.translations[0]?.translatedText || "N√£o consegui traduzir.";
      } catch { return "Erro ao traduzir."; }
    }

    async function processMessage(text) {
      showTyping();

      setTimeout(async () => {
        removeTyping();

        // Bloqueio de temas restritos
        if (text.toLowerCase().includes("sexo") || text.toLowerCase().includes("erotismo") || text.toLowerCase().includes("intim")) {
          appendMessage("eva", "‚ö†Ô∏è Esse tema n√£o est√° dispon√≠vel aqui. Tenta outro assunto.");
          return;
        }

        // Clima
        if (text.toLowerCase().includes("clima em")) {
          const city = text.split("clima em")[1].trim();
          appendMessage("eva", await getWeather(city)); return;
        }

        // Tradu√ß√£o
        if (text.toLowerCase().startsWith("traduz")) {
          const match = text.match(/para (\w+)/i);
          let target = "en";
          if (match) {
            const lang = match[1].toLowerCase();
            if (lang.includes("ingl")) target="en";
            else if (lang.includes("fran")) target="fr";
            else if (lang.includes("espa")) target="es";
            else if (lang.includes("ital")) target="it";
            else if (lang.includes("alem")) target="de";
            else { appendMessage("eva","Idioma n√£o suportado."); return; }
          }
          const phrase = text.replace(/traduz/i,"").replace(/para \w+/i,"").trim();
          if (!phrase) { appendMessage("eva","O que queres que eu traduza?"); return; }
          appendMessage("eva",`Tradu√ß√£o: ${await translateText(phrase,target)}`); return;
        }

        // Wikipedia
        const wiki = await getWiki(text);
        if (wiki) { appendMessage("eva", wiki); return; }

        // YouTube fallback
        const yt = await getYouTube(text);
        if (yt) { appendMessage("eva", yt); return; }

        // Educado fallback
        appendMessage("eva","ü§∑‚Äç‚ôÄÔ∏è N√£o encontrei nada √∫til desta vez. Tenta reformular a pergunta.");
      }, 1200); // atraso para parecer natural
    }

    sendBtn.addEventListener("click", () => {
      const text = input.value.trim();
      if (!text) return;
      appendMessage("user", text);
      input.value = "";
      processMessage(text);
    });

    input.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault(); sendBtn.click();
      }
    });
  </script>
</body>
</html>
