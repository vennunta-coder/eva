<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EVA - Assistente Virtual</title>
  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/evafavicon.ico">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f5f6fa;
    }
    .bubble-user {
      background: #0078FF;
      color: white;
      border-radius: 1.2rem;
      border-top-right-radius: 0.4rem;
      padding: 0.6rem 1rem;
      max-width: 75%;
    }
    .bubble-ai {
      background: #e4e6eb;
      color: #111;
      border-radius: 1.2rem;
      border-top-left-radius: 0.4rem;
      padding: 0.6rem 1rem;
      max-width: 75%;
    }
    footer {
      font-size: 14px;
      color: #666;
      text-align: center;
      padding: 0.8rem;
    }
    footer span.orange { color: orange; }

    /* Indicador digitando */
    .typing-indicator {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .typing-indicator span {
      width: 8px;
      height: 8px;
      background: #555;
      border-radius: 50%;
      display: inline-block;
      animation: blink 1.4s infinite both;
    }
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes blink {
      0% { opacity: .2; }
      20% { opacity: 1; }
      100% { opacity: .2; }
    }

    /* === ESTILOS ANIMADOS EXTRA === */
    @keyframes shine {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .gradient-text {
      background: linear-gradient(
        90deg,
        #60a5fa,
        #3b82f6,
        #2563eb,
        #4f46e5,
        #3b82f6,
        #60a5fa
      );
      background-size: 200% auto;
      animation: shine 3s linear infinite;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    @keyframes slideInLeft {
      0% { transform: translateX(-20px); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideInRight {
      0% { transform: translateX(20px); opacity: 0; }
      100% { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeInUp {
      0% { transform: translateY(10px); opacity: 0; }
      100% { transform: translateY(0); opacity: 1; }
    }
    .typing-cursor::after {
      content: '|';
      margin-left: 1px;
      animation: cursor 1s infinite step-end;
    }
    .typing-cursor-hidden::after {
      visibility: hidden;
    }
    @keyframes cursor {
      50% { opacity: 0; }
    }
    .slide-in-left { animation: slideInLeft 0.7s ease forwards; }
    .slide-in-right { animation: slideInRight 0.7s ease forwards; }
    .fade-in-up { opacity: 0; animation: fadeInUp 0.7s ease forwards; }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <!-- Header -->
  <header class="bg-white border-b p-4 flex items-center space-x-2 shadow-sm">
    <img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/logoeva.png" alt="EVA" class="w-10 h-10">
    <h1 class="text-2xl font-bold gradient-text">EVA</h1>
  </header>

  <!-- Chat -->
  <main id="chat" class="flex-1 overflow-y-auto p-4 space-y-4">
    <!-- Mensagem inicial da EVA -->
    <div class="flex items-start space-x-2 slide-in-left">
      <img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/logoeva.png" class="w-8 h-8">
      <div class="bubble-ai">
        Ol√°! Eu sou a EVA.<br>Estou pronta para responder √†s tuas perguntas.
      </div>
    </div>
  </main>

  <!-- Input -->
  <div class="bg-white border-t p-3 flex space-x-2">
    <textarea id="userInput" rows="1" placeholder="Escreve aqui..." 
      class="flex-1 resize-none border rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"></textarea>
    <button onclick="handleSend()" 
      class="bg-blue-500 text-white rounded-full px-5 py-2 font-semibold hover:bg-blue-600">
      Enviar
    </button>
  </div>

  <!-- Footer -->
  <footer>
    <span class="text-black">E</span><span class="orange">V</span><span class="text-black">A</span> ¬© 2025
  </footer>

  <script>
    const chatMessages = document.getElementById("chat");

    const WEATHER_KEY = "7db838cde261492656dc201d1d17e4aa";
    const GOOGLE_KEY = "AIzaSyD3OOOrDwc5KtuiUAzg1Pq2dGGVaRJjU3s";

    function addMessage(sender, text) {
      const div = document.createElement("div");
      div.className = "flex items-start space-x-2 " + 
                      (sender === "user" ? "justify-end slide-in-right" : "slide-in-left");
      if (sender === "eva") {
        div.innerHTML = `
          <img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/logoeva.png" class="w-8 h-8">
          <div class="bubble-ai fade-in-up">${text}</div>`;
      } else {
        div.innerHTML = `<div class="bubble-user fade-in-up">${text}</div>`;
      }
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function showTyping() {
      const div = document.createElement("div");
      div.id = "typing";
      div.className = "flex items-start space-x-2";
      div.innerHTML = `
        <img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/logoeva.png" class="w-8 h-8">
        <div class="bubble-ai typing-indicator">
          <span></span><span></span><span></span>
        </div>`;
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function hideTyping() {
      const typingDiv = document.getElementById("typing");
      if (typingDiv) typingDiv.remove();
    }

    async function handleSend() {
      const input = document.getElementById("userInput");
      const text = input.value.trim();
      if (!text) return;
      addMessage("user", text);
      input.value = "";
      
      showTyping();

      setTimeout(async () => {
        const reply = await processMessage(text);
        hideTyping();
        addMessage("eva", reply);
      }, 1500);
    }

    async function getWeather(city) {
      try {
        const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${WEATHER_KEY}&units=metric&lang=pt`);
        const data = await res.json();
        if (data.cod === 200) {
          return `Clima em ${city}: ${data.weather[0].description}, üå°Ô∏è ${data.main.temp}¬∞C (sensa√ß√£o ${data.main.feels_like}¬∞C).`;
        } else {
          return "N√£o consegui encontrar o clima dessa cidade.";
        }
      } catch (e) {
        return "Erro ao aceder ao clima.";
      }
    }

    async function translateText(text, targetLang) {
      try {
        const resp = await fetch(`https://translation.googleapis.com/language/translate/v2?key=${GOOGLE_KEY}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ q: text, target: targetLang })
        });
        const data = await resp.json();
        if (data.data?.translations?.[0]?.translatedText) {
          return data.data.translations[0].translatedText;
        } else {
          return "N√£o consegui traduzir agora.";
        }
      } catch {
        return "Erro ao usar a API de tradu√ß√£o.";
      }
    }

    async function getWikipediaSummary(query) {
      try {
        const title = query.replace(/(wikipedia|quem √©|o que √©)/i, "").trim();
        const res = await fetch(`https://pt.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`);
        if (!res.ok) return "N√£o encontrei nada no Wikipedia.";
        const data = await res.json();
        return data.extract ? data.extract : "N√£o encontrei um resumo no Wikipedia.";
      } catch {
        return "Erro ao aceder ao Wikipedia.";
      }
    }

    async function processMessage(query) {
      const lower = query.toLowerCase();

      // üå§Ô∏è Clima
      if (lower.includes("clima") || lower.includes("tempo")) {
        const match = query.match(/em ([a-zA-Z√Ä-√ø\s]+)/i);
        if (match) {
          const city = match[1];
          return await getWeather(city);
        }
        return "Diz-me a cidade para eu ver o clima.";
      }

      // üåç Tradu√ß√£o sob pedido
      if (lower.startsWith("traduz")) {
        const match = query.match(/para (\w+)/i);
        let targetLang = "en"; 
        if (match) {
          const lang = match[1].toLowerCase();
          if (lang.includes("ingl")) targetLang = "en";
          else if (lang.includes("fran")) targetLang = "fr";
          else if (lang.includes("espa")) targetLang = "es";
          else if (lang.includes("ital")) targetLang = "it";
          else if (lang.includes("alem")) targetLang = "de";
          else return "N√£o reconhe√ßo esse idioma. Usa ingl√™s, franc√™s, espanhol, italiano ou alem√£o.";
        }
        const phrase = query.replace(/traduz/i, "").replace(/para \w+/i, "").trim();
        if (!phrase) return "O que queres que eu traduza?";
        return "Tradu√ß√£o: " + await translateText(phrase, targetLang);
      }

      // ‚ù§Ô∏è Erotismo/sexo
      if (lower.includes("sexo") || lower.includes("erotismo")) {
        return "Esse √© um tema √≠ntimo. Posso dar-te informa√ß√µes educativas sobre sexualidade, rela√ß√µes e sa√∫de.";
      }

      // üìö Wikipedia
      if (lower.includes("wikipedia") || lower.includes("quem √©") || lower.includes("o que √©")) {
        return await getWikipediaSummary(query);
      }

      // ü§∑ Fallback
      return "N√£o encontrei em fontes externas, mas posso dar-te uma explica√ß√£o geral. Faz outra pergunta se quiseres.";
    }
  </script>
</body>
</html>
