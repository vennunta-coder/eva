<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EVA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Estilos base (Mantenho os seus estilos e adiciono Tailwind para responsividade e visual) */
    body {
      font-family: Arial, sans-serif;
      background: #f7f7f7; /* Cor de fundo mais clara */
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      color: #333;
    }
    header {
      font-size: 24px;
      font-weight: 700; /* Bold */
      padding: 15px 20px;
      background: #fff;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      color: #1a73e8; /* Cor principal */
    }
    header span.v { color: #f90; } /* Laranja */
    main {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    /* Estilos das mensagens */
    .mensagem {
      max-width: 85%; /* Aumenta um pouco para dispositivos m√≥veis */
      padding: 12px 16px;
      border-radius: 18px; /* Cantos mais arredondados */
      line-height: 1.4;
      display: flex;
      align-items: flex-start;
      gap: 10px;
      word-wrap: break-word;
    }
    .usuario {
      background: #1a73e8;
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 4px; /* Ponta da bolha */
    }
    .eva {
      background: #eef1f5;
      color: #333;
      margin-right: auto;
      border-bottom-left-radius: 4px; /* Ponta da bolha */
    }
    .eva .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      flex-shrink: 0;
      background: #ddd; /* Fundo se a imagem falhar */
    }
    footer {
      text-align: center;
      padding: 10px;
      font-size: 13px;
      color: #888;
    }
    .entrada {
      display: flex;
      padding: 10px;
      background: #fff;
      border-top: 1px solid #eee;
      align-items: center;
    }
    .entrada input {
      flex: 1;
      padding: 12px 18px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 25px;
      outline: none;
      transition: border-color 0.3s;
    }
    .entrada input:focus {
      border-color: #1a73e8;
    }
    .entrada button {
      margin-left: 8px;
      padding: 12px 18px;
      border: none;
      background: #1a73e8;
      color: white;
      border-radius: 25px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .entrada button:hover {
      background: #155cb8;
    }
    .loading-indicator {
      display: none;
      color: #888;
      font-style: italic;
      padding-left: 42px; /* Alinha com o texto EVA */
    }
  </style>
</head>
<body>
  <header><span>E</span><span class="v">V</span><span>A</span></header>

  <main id="chat">
    <div class="mensagem eva">
      <img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/evalogo.png" class="avatar" alt="EVA Avatar">
      <div><b><span>E</span><span class="v">V</span><span>A</span>:</b> Ol√°! Eu sou a EVA, sua assistente de IA. Pergunte-me qualquer coisa sobre o tempo, curiosidades, ou qualquer outra coisa que precisar!</div>
    </div>
  </main>

  <div class="entrada">
    <input type="text" id="pergunta" placeholder="Mensagem..." onkeypress="if(event.keyCode===13) enviarMensagem()">
    <button onclick="enviarMensagem()">Enviar</button>
  </div>
  <div id="loading" class="loading-indicator">EVA est√° a pensar...</div>

  <footer><span>E</span><span class="v">V</span><span>A</span> ¬© 2025</footer>

  <script>
    const OPENWEATHER_API_KEY = "7db838cde261492656dc201d1d17e4aa";
    // A chave da API Gemini ser√° fornecida automaticamente pelo ambiente
    const apiKey = ""; 

    // Fun√ß√£o: API Gemini (para perguntas gerais)
    async function getGeminiResponse(query) {
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

      const systemPrompt = "Voc√™ √© EVA, uma assistente virtual prestativa, concisa e amig√°vel. Responda √† pergunta do usu√°rio de forma direta e em portugu√™s. Use apenas informa√ß√µes que voc√™ possa confirmar e use formata√ß√£o Markdown para listas ou negrito se for √∫til.";

      const payload = {
        contents: [{ parts: [{ text: query }] }],
        // Usar Google Search para respostas factuais e atualizadas
        tools: [{ "google_search": {} }],
        systemInstruction: {
          parts: [{ text: systemPrompt }]
        },
      };

      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!response.ok) {
          console.error('Gemini API HTTP Error:', response.status, response.statusText);
          return "‚ùå Ocorreu um erro ao tentar conectar com a minha intelig√™ncia (Erro HTTP). Por favor, tente novamente.";
        }

        const result = await response.json();
        const candidate = result.candidates?.[0];

        if (candidate && candidate.content?.parts?.[0]?.text) {
          // A resposta da IA
          return candidate.content.parts[0].text;
        } else {
          // Se a resposta estiver vazia ou inv√°lida
          return "üòï N√£o consegui gerar uma resposta para isso. Tente refazer a pergunta ou tente mais tarde.";
        }
      } catch (error) {
        console.error('Gemini API Fetch Error:', error);
        return "‚ö†Ô∏è Ocorreu um erro de rede. Verifique sua conex√£o ou tente mais tarde.";
      }
    }

    // Fun√ß√£o: Clima
    async function getWeather(city) {
      const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${OPENWEATHER_API_KEY}&units=metric&lang=pt`;
      try {
        const response = await fetch(url);
        const data = await response.json();
        if (data.cod === 200) {
          return `üå§Ô∏è Clima em ${data.name}: ${data.weather[0].description}, **${Math.round(data.main.temp)}¬∞C** (sensa√ß√£o ${Math.round(data.main.feels_like)}¬∞C), humidade ${data.main.humidity}%, vento ${data.wind.speed} km/h.`;
        } else {
          // Para evitar o fallback para o Google em caso de erro 404 de cidade
          return "‚ùå N√£o consegui encontrar informa√ß√µes sobre o clima para essa cidade.";
        }
      } catch {
        return "‚ö†Ô∏è Erro ao conectar ao servi√ßo do tempo. Tente novamente.";
      }
    }

    // Fun√ß√£o: Processar pergunta
    async function processarPergunta(pergunta) {
      pergunta = pergunta.toLowerCase().trim();

      // 1. Ano Atual
      if (pergunta.includes("que ano") || pergunta.includes("em que ano estamos") || pergunta.includes("ano atual")) {
        const anoAtual = new Date().getFullYear();
        return `üìÖ Estamos no ano de **${anoAtual}**.`;
      }

      // 2. Clima (Usa a fun√ß√£o de terceiros, pois √© mais r√°pida para o clima)
      if (pergunta.includes("tempo em") || pergunta.includes("clima em") || pergunta.includes("vai chover")) {
        let cidade = pergunta.replace("tempo em", "")
                             .replace("clima em", "")
                             .replace("vai chover em", "")
                             .trim();
        if (cidade.length > 0) {
          return await getWeather(cidade);
        } else {
          return "Por favor, diga o nome da cidade para eu verificar o clima. üåç";
        }
      }

      // 3. Fallback inteligente (Agora usando o Gemini para tudo o resto)
      return await getGeminiResponse(pergunta);
    }

    // Enviar mensagem
    async function enviarMensagem() {
      const input = document.getElementById("pergunta");
      const loading = document.getElementById("loading");
      const pergunta = input.value.trim();
      if (!pergunta) return;

      const chat = document.getElementById("chat");

      // Mensagem do Usu√°rio
      const divUser = document.createElement("div");
      divUser.className = "mensagem usuario";
      divUser.innerText = pergunta;
      chat.appendChild(divUser);

      input.value = "";
      input.disabled = true; // Desabilita o input durante o processamento
      loading.style.display = 'block'; // Mostra o indicador de loading
      chat.scrollTop = chat.scrollHeight;

      // EVA resposta
      const resposta = await processarPergunta(pergunta);
      
      loading.style.display = 'none'; // Esconde o indicador de loading
      input.disabled = false; // Reabilita o input

      const divEva = document.createElement("div");
      divEva.className = "mensagem eva";
      // O innerHTML √© usado para renderizar o Markdown da resposta do LLM
      divEva.innerHTML = `<img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/evalogo.png" class="avatar" alt="EVA Avatar"><div><b><span>E</span><span class="v">V</span><span>A</span>:</b> ${resposta}</div>`;
      chat.appendChild(divEva);

      chat.scrollTop = chat.scrollHeight;
      input.focus(); // Coloca o foco de volta na caixa de texto
    }
  </script>
</body>
</html>

