<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EVA - Assistente de IA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #f0f2f5; display: flex; flex-direction: column; min-height: 100vh; font-size: 25px; }

    @media (prefers-color-scheme: dark) {
      body { background: #111827; }
      header { background: #1f2937 !important; color: #f9fafb !important; }
      #chat-messages { background: #111827; }
      .bubble-ai { background:#374151; color:#f9fafb; }
      .bubble-user { background:#2563eb; color:white; }
      .input-bar { background:#1f2937; border-color:#374151; }
      textarea { background: #111827; color: #f9fafb; }
      footer { background:#1f2937; color:#9ca3af; font-size:20px !important; }
    }

    .bubble-ai { border-radius: 1.5rem; border-top-left-radius: .5rem; background:#e4e6eb; color:#1c1e21; font-size:25px; }
    .bubble-user { border-radius: 1.5rem; border-top-right-radius: .5rem; background:#0078FF; color:white; font-size:25px; }

    main { flex: 1; display: flex; flex-direction: column; }
    textarea, button, header { font-size: 25px !important; }
    footer { font-size: 20px !important; }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="h-16 bg-white border-b flex items-center px-8 font-bold shadow">
    EVA
  </header>
  
  <!-- ConteÃºdo Principal -->
  <main>
    <div id="chat-messages" class="flex-1 overflow-y-auto p-6 space-y-5 bg-white">
      <div class="flex justify-start">
        <div class="bubble-ai p-5 leading-relaxed shadow-sm">
          OlÃ¡! Eu sou a EVA.<br><br>
          JÃ¡ vens com choradeira ou com piada?
        </div>
      </div>
    </div>

    <!-- Input -->
    <div class="p-5 input-bar bg-gray-100 flex items-center border-t shadow-lg">
      <textarea id="user-input" placeholder="Mensagem..." 
        class="flex-1 p-3 rounded-lg border resize-none h-14"></textarea>
      <button id="send-button" 
        class="ml-4 px-8 py-3 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 transition">
        Enviar
      </button>
    </div>
  </main>

  <!-- RodapÃ© -->
  <footer class="h-12 bg-gray-200 text-gray-600 flex items-center justify-center border-t">
    EVA Â© 2025
  </footer>

<script>
const API_KEY_GEMINI = "AIzaSyBBaANH7WwPwdCw5lzkuhxTGtX77r6u5QQ"; 

function scrollToBottom() {
  const chat = document.getElementById("chat-messages");
  chat.scrollTop = chat.scrollHeight;
}
function addMessage(sender, text) {
  const chat = document.getElementById("chat-messages");
  const div = document.createElement("div");
  div.className = "flex " + (sender === "user" ? "justify-end" : "justify-start");
  div.innerHTML = `<div class="${sender==="user"?"bubble-user":"bubble-ai"} p-5 leading-relaxed">${text}</div>`;
  chat.appendChild(div);
  scrollToBottom();
}

/* === Wikipedia === */
async function wikiSummary(topic) {
  const url = `https://pt.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(topic)}`;
  const res = await fetch(url);
  if (!res.ok) return "NÃ£o encontrei nada na Wikipedia ðŸ“š";
  const data = await res.json();
  return `ðŸ“– <b>${data.title}</b><br>${data.extract}<br><a href="${data.content_urls.desktop.page}" target="_blank">Ler mais</a>`;
}

/* === Gemini === */
async function getAiResponse(query) {
  const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY_GEMINI}`;
  let systemPrompt = "VocÃª Ã© EVA, uma assistente de IA sarcÃ¡stica, bem-humorada e ligeiramente cÃ­nica. Responda SEMPRE em portuguÃªs de Portugal.";
  const payload = { contents: [{ parts: [{ text: query }] }], systemInstruction: { parts: [{ text: systemPrompt }] } };
  const res = await fetch(apiUrl, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(payload) });
  const data = await res.json();
  return data.candidates?.[0]?.content?.parts?.[0]?.text || "NÃ£o consegui pensar em nada agora ðŸ¤·â€â™€ï¸";
}

/* === Comandos EVA === */
async function handleCommand(query) {
  const q = query.toLowerCase();

  // ðŸ“… CalendÃ¡rio local expandido
  if (q.includes("hora") || q.includes("horas")) {
    const agora = new Date();
    return `â° Agora sÃ£o ${agora.toLocaleTimeString("pt-PT", {hour:"2-digit", minute:"2-digit"})}`;
  }
  if (q.includes("data") || q.includes("dia de hoje") || q.includes("hoje")) {
    const agora = new Date();
    return `ðŸ“… Hoje Ã© ${agora.toLocaleDateString("pt-PT", {weekday:"long", day:"2-digit", month:"long", year:"numeric"})}`;
  }
  if (q.includes("ano")) {
    const ano = new Date().getFullYear();
    return `ðŸ“† Estamos no ano de ${ano}`;
  }

  // FUTURO
  let matchDiasFuturo = q.match(/daqui a (\d+) dia/);
  if (matchDiasFuturo) {
    const dias = parseInt(matchDiasFuturo[1]);
    let data = new Date();
    data.setDate(data.getDate() + dias);
    return `ðŸ“… Daqui a ${dias} dias serÃ¡ ${data.toLocaleDateString("pt-PT",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})}`;
  }
  let matchSemanasFuturo = q.match(/daqui a (\d+) semana/);
  if (matchSemanasFuturo) {
    const semanas = parseInt(matchSemanasFuturo[1]);
    let data = new Date();
    data.setDate(data.getDate() + (semanas * 7));
    return `ðŸ“… Daqui a ${semanas} semana${semanas>1?"s":""} serÃ¡ ${data.toLocaleDateString("pt-PT",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})}`;
  }
  let matchMesesFuturo = q.match(/daqui a (\d+) mes/);
  if (matchMesesFuturo) {
    const meses = parseInt(matchMesesFuturo[1]);
    let data = new Date();
    data.setMonth(data.getMonth() + meses);
    return `ðŸ“… Daqui a ${meses} meses serÃ¡ ${data.toLocaleDateString("pt-PT",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})}`;
  }
  let matchAnosFuturo = q.match(/daqui a (\d+) ano/);
  if (matchAnosFuturo) {
    const anos = parseInt(matchAnosFuturo[1]);
    let data = new Date();
    data.setFullYear(data.getFullYear() + anos);
    return `ðŸ“… Daqui a ${anos} anos serÃ¡ ${data.toLocaleDateString("pt-PT",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})}`;
  }
  let matchHorasFuturo = q.match(/daqui a (\d+) hora/);
  if (matchHorasFuturo) {
    const horas = parseInt(matchHorasFuturo[1]);
    let data = new Date();
    data.setHours(data.getHours() + horas);
    return `â° Daqui a ${horas} hora${horas>1?"s":""} serÃ¡ ${data.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"})} (${data.toLocaleDateString("pt-PT",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})})`;
  }
  let matchMinFuturo = q.match(/daqui a (\d+) minuto/);
  if (matchMinFuturo) {
    const mins = parseInt(matchMinFuturo[1]);
    let data = new Date();
    data.setMinutes(data.getMinutes() + mins);
    return `â° Daqui a ${mins} minuto${mins>1?"s":""} serÃ¡ ${data.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"})}`;
  }

  // PASSADO
  let matchDiasPassado = q.match(/hÃ¡ (\d+) dia/);
  if (matchDiasPassado) {
    const dias = parseInt(matchDiasPassado[1]);
    let data = new Date();
    data.setDate(data.getDate() - dias);
    return `ðŸ“… HÃ¡ ${dias} dias atrÃ¡s foi ${data.toLocaleDateString("pt-PT",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})}`;
  }
  let matchSemanasPassado = q.match(/hÃ¡ (\d+) semana/);
  if (matchSemanasPassado) {
    const semanas = parseInt(matchSemanasPassado[1]);
    let data = new Date();
    data.setDate(data.getDate() - (semanas * 7));
    return `ðŸ“… HÃ¡ ${semanas} semana${semanas>1?"s":""} atrÃ¡s foi ${data.toLocaleDateString("pt-PT",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})}`;
  }
  let matchMesesPassado = q.match(/hÃ¡ (\d+) mes/);
  if (matchMesesPassado) {
    const meses = parseInt(matchMesesPassado[1]);
    let data = new Date();
    data.setMonth(data.getMonth() - meses);
    return `ðŸ“… HÃ¡ ${meses} meses atrÃ¡s foi ${data.toLocaleDateString("pt-PT",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})}`;
  }
  let matchAnosPassado = q.match(/hÃ¡ (\d+) ano/);
  if (matchAnosPassado) {
    const anos = parseInt(matchAnosPassado[1]);
    let data = new Date();
    data.setFullYear(data.getFullYear() - anos);
    return `ðŸ“… HÃ¡ ${anos} anos atrÃ¡s foi ${data.toLocaleDateString("pt-PT",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})}`;
  }
  let matchHorasPassado = q.match(/hÃ¡ (\d+) hora/);
  if (matchHorasPassado) {
    const horas = parseInt(matchHorasPassado[1]);
    let data = new Date();
    data.setHours(data.getHours() - horas);
    return `â° HÃ¡ ${horas} hora${horas>1?"s":""} atrÃ¡s foi ${data.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"})} (${data.toLocaleDateString("pt-PT",{weekday:"long",day:"2-digit",month:"long",year:"numeric"})})`;
  }
  let matchMinPassado = q.match(/hÃ¡ (\d+) minuto/);
  if (matchMinPassado) {
    const mins = parseInt(matchMinPassado[1]);
    let data = new Date();
    data.setMinutes(data.getMinutes() - mins);
    return `â° HÃ¡ ${mins} minuto${mins>1?"s":""} atrÃ¡s foi ${data.toLocaleTimeString("pt-PT",{hour:"2-digit",minute:"2-digit"})}`;
  }

  // Wikipedia
  if (q.startsWith("wikipedia:") || q.startsWith("resumo:") || q.includes("quem foi") || q.includes("o que Ã©")) {
    return await wikiSummary(q.replace(/wikipedia:|resumo:|quem foi|o que Ã©/gi,"").trim());
  }

  // Gemini
  return await getAiResponse(query);
}

/* === Chat === */
document.getElementById("send-button").addEventListener("click", async () => {
  const input = document.getElementById("user-input");
  const text = input.value.trim();
  if (!text) return;
  addMessage("user", text);
  input.value = "";

  const reply = await handleCommand(text);
  addMessage("ai", reply);
});
</script>
</body>
</html>
