<!DOCTYPE html>
<html lang="pt">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>EVA - Assistente Virtual</title>
Â  <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/evafavicon.ico">
Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <style>
Â  Â  body {
Â  Â  Â  font-family: 'Inter', sans-serif;
Â  Â  Â  background: #f5f6fa;
Â  Â  }
Â  Â  .bubble-user {
Â  Â  Â  background: #0078FF;
Â  Â  Â  color: white;
Â  Â  Â  border-radius: 1.2rem;
Â  Â  Â  border-top-right-radius: 0.4rem;
Â  Â  Â  padding: 0.6rem 1rem;
Â  Â  Â  max-width: 75%;
Â  Â  Â  word-wrap: break-word; /* Garante que o texto quebre corretamente */
Â  Â  }
Â  Â  .bubble-ai {
Â  Â  Â  background: #e4e6eb;
Â  Â  Â  color: #111;
Â  Â  Â  border-radius: 1.2rem;
Â  Â  Â  border-top-left-radius: 0.4rem;
Â  Â  Â  padding: 0.6rem 1rem;
Â  Â  Â  max-width: 75%;
Â  Â  Â  word-wrap: break-word;
Â  Â  }
Â  Â  footer {
Â  Â  Â  font-size: 14px;
Â  Â  Â  color: #666;
Â  Â  Â  text-align: center;
Â  Â  Â  padding: 0.8rem;
Â  Â  }
Â  Â  footer span.orange { color: orange; }

Â  Â  /* Indicador digitando */
Â  Â  .typing-indicator {
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  gap: 4px;
Â  Â  }
Â  Â  .typing-indicator span {
Â  Â  Â  width: 8px;
Â  Â  Â  height: 8px;
Â  Â  Â  background: #555;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  display: inline-block;
Â  Â  Â  animation: blink 1.4s infinite both;
Â  Â  }
Â  Â  .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
Â  Â  .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
Â  Â  @keyframes blink {
Â  Â  Â  0% { opacity: .2; }
Â  Â  Â  20% { opacity: 1; }
Â  Â  Â  100% { opacity: .2; }
Â  Â  }

Â  Â  /* === ESTILOS ANIMADOS EXTRA === */
Â  Â  @keyframes shine {
Â  Â  Â  0% { background-position: 0% 50%; }
Â  Â  Â  50% { background-position: 100% 50%; }
Â  Â  Â  100% { background-position: 0% 50%; }
Â  Â  }
Â  Â  .gradient-text {
Â  Â  Â  background: linear-gradient(
Â  Â  Â  Â  90deg,
Â  Â  Â  Â  #60a5fa,
Â  Â  Â  Â  #3b82f6,
Â  Â  Â  Â  #2563eb,
Â  Â  Â  Â  #4f46e5,
Â  Â  Â  Â  #3b82f6,
Â  Â  Â  Â  #60a5fa
Â  Â  Â  );
Â  Â  Â  background-size: 200% auto;
Â  Â  Â  animation: shine 3s linear infinite;
Â  Â  Â  -webkit-background-clip: text;
Â  Â  Â  -webkit-text-fill-color: transparent;
Â  Â  Â  background-clip: text;
Â  Â  }
Â  Â  @keyframes slideInLeft {
Â  Â  Â  0% { transform: translateX(-20px); opacity: 0; }
Â  Â  Â  100% { transform: translateX(0); opacity: 1; }
Â  Â  }
Â  Â  @keyframes slideInRight {
Â  Â  Â  0% { transform: translateX(20px); opacity: 0; }
Â  Â  Â  100% { transform: translateX(0); opacity: 1; }
Â  Â  }
Â  Â  @keyframes fadeInUp {
Â  Â  Â  0% { transform: translateY(10px); opacity: 0; }
Â  Â  Â  100% { transform: translateY(0); opacity: 1; }
Â  Â  }
Â  Â  .slide-in-left { animation: slideInLeft 0.7s ease forwards; }
Â  Â  .slide-in-right { animation: slideInRight 0.7s ease forwards; }
Â  Â  .fade-in-up { opacity: 0; animation: fadeInUp 0.7s ease forwards; }
Â  Â  .source-link {
Â  Â  Â  display: block;
Â  Â  Â  font-size: 0.7rem;
Â  Â  Â  color: #3b82f6;
Â  Â  Â  text-decoration: none;
Â  Â  Â  margin-top: 0.5rem;
Â  Â  Â  opacity: 0.8;
Â  Â  Â  transition: opacity 0.2s;
Â  Â  }
Â  Â  .source-link:hover {
Â  Â  Â  opacity: 1;
Â  Â  Â  text-decoration: underline;
Â  Â  }
Â  </style>
</head>
<body class="flex flex-col min-h-screen">

Â  <!-- Header -->
Â  <header class="bg-white border-b p-4 flex items-center space-x-2 shadow-sm">
Â  Â  <img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/logoeva.png" alt="EVA" class="w-10 h-10">
Â  Â  <h1 class="text-2xl font-bold gradient-text">EVA</h1>
Â  </header>

Â  <!-- Chat -->
Â  <main id="chat" class="flex-1 overflow-y-auto p-4 space-y-4">
Â  Â  <!-- Mensagem inicial da EVA -->
Â  Â  <div class="flex items-start space-x-2 slide-in-left">
Â  Â  Â  <img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/logoeva.png" class="w-8 h-8">
Â  Â  Â  <div class="bubble-ai">
Â  Â  Â  Â  OlÃ¡! Eu sou a EVA.<br>Estou pronta para responder Ã s tuas perguntas.
Â  Â  Â  </div>
Â  Â  </div>
Â  </main>

Â  <!-- Input -->
Â  <div class="bg-white border-t p-3 flex space-x-2">
Â  Â  <textarea id="userInput" rows="1" placeholder="Escreve aqui..."Â 
Â  Â  Â  class="flex-1 resize-none border rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-400"></textarea>
Â  Â  <button onclick="handleSend()"Â 
Â  Â  Â  class="bg-blue-500 text-white rounded-full px-5 py-2 font-semibold hover:bg-blue-600">
Â  Â  Â  Enviar
Â  Â  </button>
Â  </div>

Â  <!-- Footer -->
Â  <footer>
Â  Â  <span class="text-black">E</span><span class="orange">V</span><span class="text-black">A</span> Â© 2025
Â  </footer>

Â  <script>
Â  Â  const chatMessages = document.getElementById("chat");

Â  Â  // Chave para a API de Clima - Mantida para funÃ§Ã£o especÃ­fica
Â  Â  const WEATHER_KEY = "7db838cde261492656dc201d1d17e4aa";

Â  Â  // ConfiguraÃ§Ã£o da API Gemini (A chave serÃ¡ injetada em tempo de execuÃ§Ã£o)
Â  Â  const GEMINI_API_KEY = "";
Â  Â  const GEMINI_API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent";

Â  Â  // VariÃ¡vel para rastrear o histÃ³rico de conversas (para contexto)
Â  Â  const chatHistory = [{ role: "model", parts: [{ text: "OlÃ¡! Eu sou a EVA. Estou pronta para responder Ã s tuas perguntas." }] }];

Â  Â  // FunÃ§Ã£o para converter Markdown para HTML
Â  Â  function formatText(text) {
Â  Â  Â  // Remove todos os tipos de asteriscos (usados para negrito/itÃ¡lico em Markdown)
Â  Â  Â  let cleanedText = text.replace(/\*+/g, '');
Â  Â  Â  // Converte quebras de linha para <br>
Â  Â  Â  return cleanedText.replace(/\n/g, '<br>');
Â  Â  }

Â  Â  // FunÃ§Ã£o para adicionar uma mensagem Ã  interface
Â  Â  function addMessage(sender, text, sources = []) {
Â  Â  Â  const div = document.createElement("div");
Â  Â  Â  div.className = "flex items-start space-x-2 " +Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (sender === "user" ? "justify-end slide-in-right" : "slide-in-left");
Â  Â  Â  
Â  Â  Â  let content = formatText(text);

Â  Â  Â  // Adiciona fontes de citaÃ§Ã£o se existirem
Â  Â  Â  if (sources.length > 0) {
Â  Â  Â  Â  const sourceHtml = sources.map(source => 
Â  Â  Â  Â  Â  `<a href="${source.uri}" target="_blank" class="source-link">Fonte: ${source.title}</a>`
Â  Â  Â  Â  ).join('');
Â  Â  Â  Â  content += sourceHtml;
Â  Â  Â  }

Â  Â  Â  if (sender === "eva") {
Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/logoeva.png" class="w-8 h-8">
Â  Â  Â  Â  Â  <div class="bubble-ai fade-in-up">${content}</div>`;
Â  Â  Â  } else {
Â  Â  Â  Â  div.innerHTML = `<div class="bubble-user fade-in-up">${content}</div>`;
Â  Â  Â  }

Â  Â  Â  chatMessages.appendChild(div);
Â  Â  Â  chatMessages.scrollTop = chatMessages.scrollHeight;
Â  Â  }

Â  Â  function showTyping() {
Â  Â  Â  const div = document.createElement("div");
Â  Â  Â  div.id = "typing";
Â  Â  Â  div.className = "flex items-start space-x-2";
Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  <img src="https://raw.githubusercontent.com/vennunta-coder/eva/refs/heads/main/logoeva.png" class="w-8 h-8">
Â  Â  Â  Â  <div class="bubble-ai typing-indicator">
Â  Â  Â  Â  Â  <span></span><span></span><span></span>
Â  Â  Â  Â  </div>`;
Â  Â  Â  chatMessages.appendChild(div);
Â  Â  Â  chatMessages.scrollTop = chatMessages.scrollHeight;
Â  Â  }

Â  Â  function hideTyping() {
Â  Â  Â  const typingDiv = document.getElementById("typing");
Â  Â  Â  if (typingDiv) typingDiv.remove();
Â  Â  }

Â  Â  // === FunÃ§Ãµes de API ===

Â  Â  // 1. FunÃ§Ã£o especÃ­fica para Clima (Mantida)
Â  Â  async function getWeather(city) {
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&appid=${WEATHER_KEY}&units=metric&lang=pt`);
Â  Â  Â  Â  const data = await res.json();
Â  Â  Â  Â  if (data.cod === 200) {
Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  text: `Clima em ${city}: ${data.weather[0].description}, ğŸŒ¡ï¸ ${data.main.temp}Â°C (sensaÃ§Ã£o ${data.main.feels_like}Â°C).`,
Â  Â  Â  Â  Â  Â  sources: []
Â  Â  Â  Â  Â  };
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  text: "NÃ£o consegui encontrar o clima dessa cidade. Por favor, verifica o nome.",
Â  Â  Â  Â  Â  Â  sources: []
Â  Â  Â  Â  Â  };
Â  Â  Â  Â  }
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  console.error("Erro ao aceder ao clima:", e);
Â  Â  Â  Â  return { text: "Erro ao aceder ao clima.", sources: [] };
Â  Â  Â  }
Â  Â  }

Â  Â  // 2. FunÃ§Ã£o principal para Gemini (Substitui Wikipedia, TraduÃ§Ã£o e Fallback)
Â  Â  async function getGeminiResponse(query) {
Â  Â  Â  
Â  Â  Â  // Adiciona a nova mensagem do usuÃ¡rio ao histÃ³rico ANTES de enviar
Â  Â  Â  chatHistory.push({ role: "user", parts: [{ text: query }] });
Â  Â  Â  
Â  Â  Â  const payload = {
Â  Â  Â  Â  contents: chatHistory,
Â  Â  Â  Â  // Usa o Google Search para respostas factuais (Grounding)
Â  Â  Â  Â  tools: [{ "google_search": {} }],
Â  Â  Â  Â  // Garante que a resposta seja em PortuguÃªs
Â  Â  Â  Â  systemInstruction: {
Â  Â  Â  Â  Â  parts: [{ text: "Tu Ã©s a EVA, uma assistente virtual amigÃ¡vel e prestÃ¡vel. Responde sempre em PortuguÃªs (Portugal)." }]
Â  Â  Â  Â  },
Â  Â  Â  };

Â  Â  Â  try {
Â  Â  Â  Â  // ConfiguraÃ§Ã£o de reintentativa (Exponential Backoff)
Â  Â  Â  Â  let response;
Â  Â  Â  Â  const maxRetries = 3;
Â  Â  Â  Â  for (let i = 0; i < maxRetries; i++) {
Â  Â  Â  Â  Â  response = await fetch(`${GEMINI_API_URL}?key=${GEMINI_API_KEY}`, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload)
Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  if (response.ok) break;

Â  Â  Â  Â  Â  const delay = Math.pow(2, i) * 1000;
Â  Â  Â  Â  Â  console.warn(`API call failed (status: ${response.status}). Retrying in ${delay / 1000}s...`);
Â  Â  Â  Â  Â  await new Promise(resolve => setTimeout(resolve, delay));

Â  Â  Â  Â  Â  if (i === maxRetries - 1) throw new Error("API call failed after max retries.");
Â  Â  Â  Â  }

Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  const candidate = result.candidates?.[0];

Â  Â  Â  Â  if (candidate && candidate.content?.parts?.[0]?.text) {
Â  Â  Â  Â  Â  const text = candidate.content.parts[0].text;
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  // Extrai fontes de citaÃ§Ã£o
Â  Â  Â  Â  Â  let sources = [];
Â  Â  Â  Â  Â  const groundingMetadata = candidate.groundingMetadata;
Â  Â  Â  Â  Â  if (groundingMetadata && groundingMetadata.groundingAttributions) {
Â  Â  Â  Â  Â  Â  Â  sources = groundingMetadata.groundingAttributions
Â  Â  Â  Â  Â  Â  Â  Â  .map(attribution => ({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  uri: attribution.web?.uri,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: attribution.web?.title,
Â  Â  Â  Â  Â  Â  Â  Â  }))
Â  Â  Â  Â  Â  Â  Â  Â  .filter(source => source.uri && source.title); // Garante que as fontes sÃ£o vÃ¡lidas
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  // Adiciona a resposta do modelo ao histÃ³rico
Â  Â  Â  Â  Â  chatHistory.push({ role: "model", parts: [{ text: text }] });
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  return { text, sources };

Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  chatHistory.pop(); // Remove a Ãºltima mensagem do usuÃ¡rio se nÃ£o houver resposta
Â  Â  Â  Â  Â  return { text: "NÃ£o consegui gerar uma resposta. Tenta reformular a tua pergunta.", sources: [] };
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Erro na chamada da API Gemini:", error);
Â  Â  Â  Â  chatHistory.pop();
Â  Â  Â  Â  return { text: "Ups! Ocorreu um erro de comunicaÃ§Ã£o. Por favor, tenta novamente mais tarde.", sources: [] };
Â  Â  Â  }
Â  Â  }

Â  Â  // === LÃ³gica de Processamento de Mensagens ===

Â  Â  async function processMessage(query) {
Â  Â  Â  const lower = query.toLowerCase();

Â  Â  Â  // 1. ğŸŒ¤ï¸ Clima (LÃ³gica especÃ­fica)
Â  Â  Â  if (lower.includes("clima") || lower.includes("tempo")) {
Â  Â  Â  Â  const match = query.match(/em ([a-zA-ZÃ€-Ã¿\s]+)/i);
Â  Â  Â  Â  if (match) {
Â  Â  Â  Â  Â  const city = match[1];
Â  Â  Â  Â  Â  return await getWeather(city);
Â  Â  Â  Â  }
Â  Â  Â  Â  // Se nÃ£o souber a cidade, usa Gemini para perguntar de forma mais natural
Â  Â  Â  Â  return getGeminiResponse("Em que cidade queres saber o clima?");
Â  Â  Â  }

Â  Â  Â  // 2. â¤ï¸ ConteÃºdo SensÃ­vel (Mantido)
Â  Â  Â  if (lower.includes("sexo") || lower.includes("erotismo")) {
Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  text: "Esse Ã© um tema Ã­ntimo. Posso dar-te informaÃ§Ãµes educativas sobre sexualidade, relaÃ§Ãµes e saÃºde, mas nÃ£o conteÃºdo erÃ³tico.",
Â  Â  Â  Â  Â  sources: []
Â  Â  Â  Â  };
Â  Â  Â  }

Â  Â  Â  // 3. ğŸ§  Resposta Geral (Usa Gemini para todas as outras perguntas)
Â  Â  Â  return await getGeminiResponse(query);
Â  Â  }
Â  Â  
Â  Â  // === LÃ³gica de Envio (HandleSend) ===

Â  Â  async function handleSend() {
Â  Â  Â  const input = document.getElementById("userInput");
Â  Â  Â  const text = input.value.trim();
Â  Â  Â  
Â  Â  Â  if (!text) return;
Â  Â  Â  
Â  Â  Â  // Adiciona a mensagem do usuÃ¡rio ao chat (UI)
Â  Â  Â  addMessage("user", text);
Â  Â  Â  input.value = "";
Â  Â  Â  input.style.height = 'auto'; // Reset a altura do textarea

Â  Â  Â  showTyping();

Â  Â  Â  const { text: replyText, sources } = await processMessage(text);
Â  Â  Â  Â  
Â  Â  Â  hideTyping();
Â  Â  Â  
Â  Â  Â  // Adiciona a resposta da EVA ao chat (UI)
Â  Â  Â  addMessage("eva", replyText, sources);
Â  Â  }

Â  Â  // Adiciona funcionalidade de redimensionamento automÃ¡tico e Enter
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  const input = document.getElementById('userInput');
Â  Â  Â  input.addEventListener('input', () => {
Â  Â  Â  Â  input.style.height = 'auto';
Â  Â  Â  Â  input.style.height = (input.scrollHeight) + 'px';
Â  Â  Â  });
Â  Â  Â  input.addEventListener('keydown', (e) => {
Â  Â  Â  Â  if (e.key === 'Enter' && !e.shiftKey) {
Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  handleSend();
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  });

Â  </script>
</body>
</html>
